

\subsection{Supercycle Membership} 


\bd[Supercycle membership, $\scyc{\B}{s}{\B_i}$]
\label{defn:supercycle.membership}
Define $\scyc{\B}{s}{\B_i}$, $\scyc{\B}{s}{\act}$ to mean that $\B_i$,
$\act$, respectively, are nodes of a supercycle of $\wfg{\B}{s}$.
\ed

If a component or interaction is not a node of a supercycle, then we say that it has a
\emph{SC-violation}, \ie a supercycle-violation.
%
The definition of a supercycle (\defn{supercycle})
imposes certain constraints on supercycle membership of neighboring
nodes in the wait-for-graph, as follows:

\bn

\item If a component $\B_i$ has an interaction $\act$ such that $\B_i \ar \act \in \wfg{\B}{t}$ and
  $\act$ has a supercycle violation, then $\act$ cannot be part of a supercycle, and therefore
  neither can $\B_i$, by Definition~\ref{def:supercycle},
  Clause~\ref{def:supercycle.component-blocked}.  Formally, if $\B_i \ar \act \in \wfg{\B}{s}$ then
  $\neg \scyc{\B}{s}{\act} \imp \neg \scyc{\B}{s}{\B_i}$.

\item If a component $\B_i$ has an interaction $\act$ such that $\act \ar \B_i \in \wfg{\B}{t}$ and
  $\act$ has a supercycle violation, then $\act$ cannot be part of a supercycle, and therefore
  neither can $\B_i$, by Definition~\ref{def:supercycle},
  Clause~\ref{def:supercycle.action-blocked}, since if $B_i$ were in a supercycle, then $\act$ would
  be too.
Formally, if $\act \ar \B_i \in \wfg{\B}{s}$ then $\scyc{\B}{s}{\B_i} \imp \scyc{\B}{s}{\act}$, and so $\neg \scyc{\B}{s}{\act} \imp \neg \scyc{\B}{s}{\B_i}$.

\en

From Clauses 1 and 2, we conclude that $\B_i$ has an SC-violation if 
$\ex \act: \B_i \ar \act \in \wfg{\B}{s} \lor \act \ar \B_i \in \wfg{\B}{s}$ and $\act$ has an SC-violation.

In some, but not all, cases, we gain some information by considering all the interactions (components) that a component
(action) waits for:

\bn

%\item If, for an interaction $\act$, all components $\B_i$ such that $\act \ar \B_i \in \wfg{\B}{t}$ have a supercycle 
%  violation, then all such components $\B_i$ cannot be part of a supercycle, and therefore neither can $\act$, 
\item For a given interaction $\act$, let $\B_i,\ldots,\B_j$ be all the components $B$ such that $\act \ar
  B \in \wfg{\B}{s}$.  Then 
 $\scyc{\B}{s}{\act} \imp (\ex B \in \B_i,\ldots,\B_j: \scyc{\B}{s}{\B_i})$, by 
  Definition~\ref{def:supercycle}, Clause~\ref{def:supercycle.action-blocked}.
  So $\act$ is in a supercycle implies that some $B \in \B_i,\ldots,\B_j$ is
  in a supercycle.  Taking the contrapositive, $(\fa B \in \B_i,\ldots,\B_j: \neg \scyc{\B}{s}{\B_i})
  \imp \neg \scyc{\B}{s}{\act}$.  Thus, if no component that $\act$ waits for is in a supercycle,
  then $\act$ cannot be in a supercycle.

\item For a given interaction $\act$, let $\B_i,\ldots,\B_j$ be all the components $B$ such that $B \ar \act \in \wfg{\B}{s}$.
Then $\neg \scyc{\B}{s}{\act} \imp (\fa B \in \B_i,\ldots,\B_j: \neg \scyc{\B}{s}{\B_i})$.
So $\act$ has an SC-violation implies that $\fa B \in \B_i,\ldots,\B_j:$ $B$ has an SC-violation.
This can be seen as a repetitive application of Clause 1 of the previous list, and so it provides no new information.

\item For a given component $\B_i$, let $\act_1,\ldots, \act_m$ be all the interactions $\act$ such that $\B_i \ar \act \in \wfg{\B}{s}$.
Then $\neg \scyc{\B}{s}{\B_i} \imp (\ex \act \in \act_1,\ldots,\act_m: \neg \scyc{\B}{s}{\act})$.
Thus $\B_i$ has an SC-violation implies that some $\act$ has an SC-violation. This is not useful, since it does not
determine the particular $\act$ with the violation. Hence this observation will not play a role in our future development.

\item For a given component $\B_i$, let $\act_1,\ldots, \act_m$ be all the interactions $\act$ such that $\act \ar \B_i \in \wfg{\B}{s}$.
Then $\scyc{\B}{s}{\B_i} \imp (\fa \act \in \act_1,\ldots,\act_m: \scyc{\B}{s}{\act})$.
Hence $(\ex \act \in \act_1,\ldots,\act_m: \neg \scyc{\B}{s}{\act}) \imp \neg \scyc{\B}{s}{\B_i}$.
Thus $\B_i$ has an SC-violation if some $\act$ that waits for $\B_i$ has an SC-violation.
This can be seen as a repetitive application of Clause 2 of the previous list, and so it provides no new information.

\en
Hence from the above 4 clauses, only clause 1 provides new information. 
Combining clauses 1 and 2 from the first list, and clause 1 from the second list, we obtain the following. 


\bp[Supercycle-membership constraints]
\label{prop:sc-membership}
$scyc$ satisfies the following constraints.
\bn

\item \label{prop:sc-membership:comp-out}
$(\ex \act: \B_i \ar \act \in \wfg{\B}{s} : \neg \scyc{\B}{s}{\act}) \imp \neg \scyc{\B}{s}{\B_i}$

\item \label{prop:sc-membership:comp-in}
$(\ex \act: \act \ar \B_i \in \wfg{\B}{s}: \neg \scyc{\B}{s}{\act}) \imp \neg \scyc{\B}{s}{\B_i}$

% both conditions in the same statement
%\item $(\ex \act: \B_i \ar \act \in \wfg{\B}{s} \lor \act \ar \B_i \in \wfg{\B}{s}: \neg \scyc{\B}{s}{\act}) \imp \neg \scyc{\B}{s}{\B_i}$

\item \label{prop:sc-membership:act-out}
For a given interaction $\act$, let $\B_i,\ldots,\B_j$ be all the components $B$ such that $\act \ar B \in \wfg{\B}{s}$.
Then $(\fa B \in \B_i,\ldots,\B_j: \neg \scyc{\B}{s}{\B_i}) \imp \neg \scyc{\B}{s}{\act}$.
\en

\ep
%
\bpr
Immediate from the preceding observations.
\epr


Definition~\ref{def:supercycle} implies that the supercycle-membership status of a node $v$ depends
solely on its outgoing wait-for edges, and the outgoing wait-for edges of the nodes that $v$ waits
for, etc. so that $v$'s supercycle-membership is a function of the subgraph of the wait-for graph
that is reachable from $v$.  Hence, we only look at outgoing wait-for edges in computing
supercycle-violation, which is just the negation of supercycle-membership.



A node that is not in any supercycle may nevertheless be a node of a wait-for cycle, since a cycle
of wait-for-edges does not necesarily imply a supercycle. Hence, to compute the supercycle violation
condition properly, we introduce a notion of the \emph{level} of a violation. A node with no
outgoing wait-for edges has a level-1 violation. A node whose violation is based on outgoing edges
to neighbors whose violation level is at most $d-1$, has itself a level-$d$ violation.  Hence we
formalize the notion of \emph{level-$d$ supercycle violation} as the predicate $\viol{v}{d}{t}$.


\bd[Supercycle violation, $\scViol{v}{d}{t}$]
\label{def:supercycle-violation}
\label{def:supercycle.violation}
Let $t$ be a state of $(\B, Q_0)$, $v$ be a node of $\wfg{\B}{t}$, and $d$ an integer $\ge 1$.
We define the predicate $\viol{v}{d}{t}$ by induction on $d$, as follows. We indicate the
justification for each clause of the definition.

\noindent
\ul{Base case, $d=1$.} $\viol{v}{1}{t}$ iff $v$ is an interaction $\act$ and it has no outgoing wait-for-edges, otherwise $\neg \viol{v}{1}{t}$.
%
Justification: if $v$ has no outgoing wait-for-edges, then it cannot be in a supercycle.  Note that $v$ must be an
interaction in this case, since a component must have at least one outgoing wait-for edge at all times.

\noindent
\ul{Inductive step, $d > 1$.}  $\viol{v}{d}{t}$ iff any of the following cases hold. Otherwise $\neg \viol{v}{d}{t}$.

\bn

\item  \label{def:supercycle.violation.component.out}
$v$ is a component $\B_i$ and there exists interaction $\act$ such that $\B_i \ar \act \in \wfg{\B}{t}$ and $(\ex d' : 1 \le d' < d: \viol{\act}{d'}{t})$.
That is, $\B_i$ enables an interaction $\act$ which has a level-$d'$ supercycle-violation, for some $d' < d$.
Justification is Proposition~\ref{prop:sc-membership}, Clause~\ref{prop:sc-membership:comp-out}.


\item \label{def:supercycle.violation.interaction.out}
$v$ is an interaction $\act$ and for all components $\B_i$ such that $\act \ar \B_i \in \wfg{\B}{t}$, we have $(\ex d' : 1 \le d' < d: \viol{\B_i}{d'}{t})$.
That is, each component $\B_i$ that $\act$ waits for has a level-$d'$ supercycle-violation, for some $d' < d$.
Justification is Proposition~\ref{prop:sc-membership}, Clause~\ref{prop:sc-membership:act-out}.

\en
\ed
%
Figure~\ref{fig:scViolate} gives a formal, recursive definition of $\viol{v}{d}{t}$. 
The notation $v = \B_i$ means that $v$ is some component $\B_i$. Likewise, 
$v = \act$ means that $v$ is some interaction $\act$.
Line 0 corresponds to the base case, line 1 corresponds to item 1 of the inductive case, and line 2 corresponds to item 2 of the inductive case.
Line 3 handles all cases that do not return true.




\begin{figure}[ht]

\setcounter{lctr}{-1}
\begin{tabbing}\label{alg:check-scViol}
aa\= aa\= aa\= \kill
$\viol{v}{d}{t}$\\
\lioc{\IFC{d = 1 \land v = \act \land \neg (\ex \B_i : \act \ar \B_i \in \wfg{\B}{t})}\ \RETURNE{\ttt}\ \FI}{\cmnt base case for \ttt\ result}
\lio{\IFC{v = \B_i \land (\ex \act : \B_i \ar \act \in \wfg{\B}{t} : (\ex d' : 1 \le d' < d : \viol{\act}{d'}{t}))} \ \RETURNE{\ttt}\ \FI}
\lio{\IFC{v = \act \land (\fa \B_i : \act \ar \B_i \in \wfg{\B}{t} : (\ex d' : 1 \le d' < d : \viol{\B_i}{d'}{t}))} \  \RETURNE{\ttt}\ \FI}
\lioc{\RETURNE{\fff}}{\cmnt no case for \ttt\ result, so result is \fff}
\end{tabbing}
\vspace{-6ex}
\caption{Formal definition of $\viol{v}{d}{t}$}
\label{fig:scViolate}
\end{figure}





% \begin{figure}[ht]

% \setcounter{lctr}{0}
% \begin{tabbing}\label{alg:check-scViol}
% mm\= mm\= mm\= mm\= mm\=\kill
% $\viol{v}{d}{t}$\\
% \lioc{\IFC{d = 1}}{base case}
%    \litc{\IFC{\neg \ex u : v \ar u \in \wfg{\B}{t}}\ \RETURNE{\ttt}}{\cmnt $v$ has no outgoing wait-for-edges}
%    \litc{\ELSE\ \RETURNE{\fff}}{\cmnt $v$ has some outgoing wait-for-edge}
%    \lit{\FI}
% \lio{\FI}

% \lio{\cmnt \mbox{now $d > 1$, \ie inductive step}}

% \lioc{\IFC{\mbox{$v$ is a component $\B_i$}}}{\cmnt component case of inductive step}
%    \lit{\IFC{\ex \act : \B_i \ar \act \in \wfg{\B}{t} : (\ex d' < d : \viol{\act}{d'}{t})}        \  \RETURNE{\ttt}}
%    \lit{\ELSE\ \RETURNE{\fff}}
%    \lit{\FI}
% \lioc{\ELSE \;\;\cmnt \mbox{$v$ is an interaction $\act$}}{\cmnt interaction case of inductive step}
%    \lit{\IFC{\fa \B_i : \act \ar \B_i \in \wfg{\B}{t} : (\ex d' < d : \viol{\B_i}{d'}{t})} \ \RETURNE{\ttt}}
%    \lit{\ELSE\ \RETURNE{\fff}}
%    \lit{\FI}
% \lio{\FI}
% \end{tabbing}
% \vspace{-6ex}
% \caption{Formal definition of $\viol{v}{d}{t}$}
% \label{fig:scViolate}
% \end{figure}


In the sequel, we say sc-violation rather than ``supercycle violation.''  The crucial result is
that, if $v$ has a level-$d$ sc-violation, for some $d \ge 1$, then $v$ cannot be a node of a
supercycle.


\bp[Soundness of supercycle violation \wrt supercycle non-membership]
 \label{prop:supercycle-violation} \label{prop:scViol-implies-notInSC}
If $(\ex d \ge 1: \viol{v}{d}{t})$ then $v$ is not a node of a supercycle in $\wfg{\B}{t}$.
\ep
\prf{
Proof is by induction in $d$. 

\noindent
\textit{Base case, $d=1$}. $v$ has no outgoing edges. Hence  $v$ cannot be in a supercycle.

\noindent
\textit{Induction step, $d >1$}. Assume that $v$ has a level $d$ $SC$-violation. We have two cases. 

\topcase{1}{$v$ is a component $\B_i$}   %\scase{1.1}{$v$ has an out-violation}
Hence there exists an interaction $\act$ such that $\B_i \ar \act \in \wfg{\B}{t}$ and $\act$ has a level-$(d-1)$
$SC$-violation. By the induction hypothesis, $\act$ cannot occur in a supercycle in $\wfg{\B}{t}$.
By Proposition~\ref{prop:sc-membership}, Clause~\ref{prop:sc-membership:comp-out}, 
$\B_i$ cannot be in a supercycle. 

% \scase{1.2}{$v$ has an in-violation}
% Hence for some interaction $\act$ such that $\act \ar \B_i \in \wfg{\B}{t}$, $\act$ has a level-$(d-1)$
% $SC$-violation. By the induction hypothesis, $\act$ cannot occur in a supercycle in $\wfg{\B}{t}$.
% By Proposition~\ref{prop:sc-membership}, Clause~\ref{prop:sc-membership:comp-in}, 
% $\B_i$ cannot be in a supercycle. 


\topcase{2}{$v$ is an interaction $\act$}    %\scase{2.1}{$v$ has an out-violation}
Hence for all components $\B_i$ such that $\act \ar \B_i \in \wfg{\B}{t}$, $\B_i$ has a level-$(d-1)$
$SC$-violation. By the induction hypothesis, $\B_i$ cannot occur in a strongly connected supercycle in $\wfg{\B}{t}$.
By Proposition~\ref{prop:sc-membership}, Clause~\ref{prop:sc-membership:act-out}, 
$\act$ cannot be in a supercycle. 

% \scase{2.2}{$v$ has an in-violation}
% Hence for all components $\B_i$ such that $\B_i \ar \act \in \wfg{\B}{t}$, $\B_i$ has a level-$(d-1)$
% $SC$-violation. By the induction hypothesis, $\B_i$ cannot occur in a strongly connected supercycle in $\wfg{\B}{t}$.
% Hence by definition~(\ref{def:supercycle}), $\act$ cannot be in a strongly connected supercycle, since $\B_i$ has no
% incoming edges that can be in a strongly connected  supercycle.
}


%In the other direction, we have a slightly weaker result: if $v$ has no level-$d$ scsc-violation,
%for all $d \ge 1$, then $v$ is a node of a supercycle.


\bp[Completeness of supercycle violation \wrt supercycle non-membership]
 \label{prop:notInSC-implies-scViol}
If $(\fas d \ge 1: \neg \viol{v}{d}{t})$ then $v$ is a node of a supercycle in $\wfg{\B}{t}$.
\ep
%
\prf{
%
Let $V$ be the set of nodes in $\wfg{\B}{t}$ with a supercycle-violation, \ie
$V = \set{w \stt w \in \wfg{\B}{t} \land (\exs d: \viol{w}{d}{t})}$.  Let $\bV$ be the remaining nodes, \ie all nodes
in $\wfg{\B}{t}$ that do not have a supercycle-violation, so 
$\bV = \set{w \stt w \in \wfg{\B}{t} \land (\fas d \ge 1: \neg \viol{v}{d}{t})}$.

if $\bV$ is empty then the proposition holds vacuously and we are done. So assume that $\bV$ is non-empty and let 
$v$ be an arbitrary node in $\bV$.

\topcase{1}{$v$ is a component $\B_i$}  
Suppose that there is a wait-for-edge from $v$ to some interaction $\act$ that is in $V$.
Then, by Definition~\ref{def:supercycle.violation}, $v$ has a supercycle violation, which contradicts the choice of $v$
as a member of $\bV$. Hence all wait-for-edges starting in $v$ must end in a node in $\bV$.

\topcase{2}{$v$ is an interaction $\act$}  
Suppose that every wait-for-edge from $v$ to some component  $\B_i$ that is in $V$.
Then, by Definition~\ref{def:supercycle.violation}, $v$ has a supercycle violation, which contradicts the choice of $v$
as a member of $\bV$. Hence some wait-for-edge starting in $v$ must end in a node in $\bV$.


Hence we have that $\bV$ satisfies all three clauses of Definition~\ref{def:supercycle}: it is nonempty, each component
in $\bV$ has all its enabled interactions also in $\bV$, and each interaction in $\bV$ waits for a component in $\bV$. 
Hence $\bV$ as a whole is a supercycle. Since the nodes of $\bV$ are, by definition of $\bV$, exactly the nodes $v$ such that 
$(\fas d \ge 1: \neg \viol{v}{d}{t})$, we have that any such node is a node of a supercycle in $\wfg{\B}{t}$. Hence the
Proposition is established.
}

%Note that the above implies that there are no wait for edges from component in $U$ to an interaction outside $U$???


\bp \label{prop:scViol-iff-notInSC}
$v$ is not a node of a supercycle in $\wfg{\B}{t}$ iff $(\ex d \ge 1: \viol{v}{d}{t})$.
\ep
\prf{Immediate from Propositions~\ref{prop:scViol-implies-notInSC} and
  \ref{prop:notInSC-implies-scViol}.}





%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{The supercycle formation condition}

\noindent
To proceed, we show that wait-for edges not involving some interaction
$\act$ and its participants $\B_i \in \cmps{\act}$ are unaffected by the execution
of $\act$.  Say that edge $e$ in a wait-for-graph
is \emph{$\B_i$-incident} iff $\B_i$ is one of the endpoints of $e$.


\bp[Wait-for edge preservation] \label{prop:wait-for-edge-preservation}
Let $s \la{\act} t$ be a transition of composite component $B =
\gamma(\B_1,\dots,\B_n)$, and let $e$ be a wait-for edge in $\wfg{\B}{s}$
that is not $\B_i$-incident, for every $\B_i \in \cmps{\act}$. Then $e \in
\wfg{\B}{s}$ iff $e \in \wfg{\B}{t}$. 
\ep
%
\prfs{
Components not involved in the execution of $\act$ do not change state
along $s \la{\act} t$. Hence the endpoint of $e$ that is a
component has the same state in $s$ as in $t$. The proposition then
follows from Definition~\ref{def:static:wait-for-graph}. 
}
%
\prf{
Fix $e$ to be an arbitrary wait-for-edge that is not
$\B_i$-incident. $e$ is either $\B_j \ar b$ or $b \ar \B_j$, for some
component $\B_j$ of $B$ that is not in $\cmps{\act}$, and an interaction $b$
(different from $\act$) that $\B_j$ participates in.
%
Now $s \pj \B_j = t \pj \B_j$, since $s \la{\act} t$ and $\B_j \not\in \cmps{\act}$. Hence $s(\gd{b}{j}) =
t(\gd{b}{j})$. It follows from Definition~\ref{def:static:wait-for-graph} that 
$e \in \wfg{\B}{s}$ iff $e \in \wfg{\B}{t}$.
}



\bp[Supercycle formation condition] \label{prop:supercycle-formation}
Assume that $s \goesto[\act] t$ is a transition of $(\B, Q_0)$, $\wfg{\B}{s}$ is supercycle-free, and that $\wfg{\B}{t}$
contains a supercycle.  Then, in $\wfg{\B}{t}$, there exists a $\CC$ such that
\bn
\item $\CC$ is a subgraph of $\wfg{\B}{t}$
\item $\CC$ is strongly connected
\item $\CC$ is a supercycle
\item  in $\wfg{\B}{t}$, there is no wait-for edge from a node in $\CC$ to a node outside of $\CC$.
\item there exists a component $\B_i \in \cmps{\act}$ such that $\B_i$ is in $\CC$
\en
\ep
%
\prf{
By assumption, there is a supercycle $\SC$ that is a subgraph of $\wfg{\B}{t}$.
By Proposition~\ref{prop:supercycle:contains-mssc}, $\SC$ contains a
subgraph $\CC$ that is strongly connected, is itself a supercycle, and
such that there is no wait-for-edge from a node in $\CC$ to a node outside of $\CC$.
This establishes Clauses~1--4.

Now suppose $\B_i \not\in \CC$ for every $\B_i \in \cmps{\act}$. Then, no edge in $\CC$ is $\B_i$-incident. 
Hence, by Proposition~\ref{prop:wait-for-edge-preservation}, every edge in $\CC$ is an edge in 
$\wfg{\B}{s}$. Hence $\CC$ is a subgraph of $\wfg{\B}{s}$. 


%Choose an arbitrary  $\B_i \in \cmps{\act}$.

% Case 1: there is no edge in $\wfg{\B}{s}$ from a node in $\CC$ to a node outside of $\CC$.

% Case 2: there exists some edge in $\wfg{\B}{s}$ from a node in $\CC$ to a node outside of $\CC$.

% Let $e$ be an arbitrary edge  from a node in $\CC$ to a node outside of $\CC$.
% $e$ cannot be present in $\wfg{\B}{t}$, by Clause~4. Hence $e$ is $\B_i$-incident, for some $\B_i \in \cmps{\act}$, by
% Proposition~\ref{prop:wait-for-edge-preservation}.  
% %
% Since $e$ starts in $\CC$ and $\B_i \not\in \CC$ for all $\B_i \in \cmps{\act}$, $e$ cannot start in $\B_i$, and so $e$ must end in $\B_i$.
% In summary, $e$ starts in some node in $\CC$ and ends in some $\B_i \in \cmps{\act}$.



Let $v$ be an arbitrary node in $\CC$. Suppose $v$ is a component $\B_j$. 
By assumption, $\B_j \not\in \cmps{\act}$, and so $s \pj \B_j = t \pj \B_j$ by 
Definition~\ref{def.bip.composition}. Hence $\B_j$ enables the same set of interactions in state $s$ as in state $t$.
in $\wfg{\B}{t}$, all of $\B_j$'s wait-for-edges must end in an interaction that is
in $\CC$, since $\CC$ is a  a supercycle in $\wfg{\B}{t}$. Hence the same holds in $\wfg{\B}{s}$.

If $v$ is an interaction, it must also have a wait-for-edge $e'$ to some component $\B_j \in \CC$, since $\CC$ is
a supercycle in $\wfg{\B}{t}$. 

Hence $v$ has enough successors in $\CC$ to satisfy the supercycle definition (Def.~\ref{def:supercycle}), 

Hence $\CC$ by itself is a supercycle in $\wfg{\B}{s}$,
which contradicts the assumption that 
$\wfg{\B}{s}$ is supercycle-free. Hence, $\B_i \in \CC$ for some $\B_i \in \cmps{\act}$, and so Clause~5 is established.
}





\subsection{Violations of the supercycle formation condition}

We wish to check whether supercycles can be formed or not, \ie whether the supercycle formation
condition is satisfied or not. In principle, we could check directly
whether $\wfg{\B}{t}$ contains a supercycle, for each reachable state
$t$. However, this approach is subject to state-explosion, and so is usually unlikely to be viable in practice.
Instead, we formulate global conditions for supercycle-freedom, and then ``project'' these
conditions onto small subsystems, to obtain local versions of these
conditions that are (1) efficiently checkable, and (2) imply the global versions.

For transition $s \goesto[\act] t$, we determine for every component $\B_i \in \cmps{\act}$ whether
it is possible for $\B_i$ to be a node in a supercycle in $\wfg{\B}{t}$. 
If not, then we say that $\B_i$ satisfies the \emph{supercycle violation} condition, and we formalize this condition below.
%
There are two ways for $\B_i$ to not be a node in a strongly-connected supercycle:
\bn
\item \textit{no supercycle membership}: $\B_i$ is not a node of any supercycle, \ie $\neg \scyc{\B}{s}{\B_i}$.

\item \textit{no strong-connectedness}: $\B_i$ is a node in a supercycle, but not a node in a \emph{strongly-connected} supercycle. 

\en
%To avoid state-explosion, we do not check the transition $s \goesto[\act] t$ itself, but rather its
%projection onto a small subsystem, which we call the







\subsection{Strong connectedness condition}
% commentary: strong connectedess violation cannot be defined "locally" in a good way, like supercycle violation
% can, since it depends on reachability, which is a global property. For a supercycle, once the set
% of ndoes is fixed, the required wait-for realtions are all local properties. HEnce, violation is
% also a local property. For strong connectedness, the best local property is "no incoming" or "no
% outging", which is just the linear condition of the FORTE 2013 paper. Hence a local condition for
% strong conectedness violation is no improvement over FORTE 2013.

Given that $\B_i$ is a node in a supercycle, we wish to determine whether or not it is a node in a
\emph{strongly-connected} supercycle. We do this by removing all nodes with supercycle-violations,
and then finding the maximal strongly connected components of the resulting wait-for subgraph.


\bd[Strong connectedness violation, $\connViol{v}{t}$]
\label{def:sConn.violation}
 Let $v$ be a node of $\wfg{\B}{t}$.   Then $\connViol{v}{t}$ holds iff there does not exist a strongly connected
 supercycle $SSC$ such that $v \in SSC$ and $SSC \sub \wfg{B}{t}$.
% Let $v$ be a node that is in a supercycle of $\wfg{\B}{t}$.  Let $W$ be the result of removing from $\wfg{\B}{t}$ every
% node $u$ such that $(\ex d \ge 1: \viol{u}{d}{t})$. Let $V$ be the maximal strongly connected component of $W$ that
% contains $v$. Then $\connViol{v}{t}$ holds iff $V$ (by itself) is not a supercycle.
% For technical convenience, we also define $\connViol{v}{t}$ to be false when $(\ex d \ge 1: \scViol{v}{d}{t})$, \ie when
% $v$ is not in a supercycle.
% Hence $\connViol{v}{t}$ is always well-defined.
\ed




\subsection{Supercycle formation violation condition}

\bd[Formation violation, $\formViol{v}{t}$]
\label{def:formation.violation}
Let $v$ be a node of $\wfg{\B}{t}$.
Then $\formViol{v}{t}  \df (\exs d \ge 1: \scViol{v}{d}{t}) \lor \connViol{v}{t}$.
\ed
%
Let $s \goesto[\act] t$ be a reachable transition. If, for every $\B_i \in \cmps{\act}$, 
$\formViol{v}{t}$ holds, then $s \goesto[\act] t$ does not introduce a supercycle, \ie if $s$ is
supercycle-free, then so is $t$. We establish this in the sequel.

We remark that, as shown above $(\exs d \ge 1: \scViol{v}{d}{t})$
implies that $v$ cannot be in a supercycle. Hence, $v$ cannot be in a strongly-connected supercycle. 
Hence $(\exs d \ge 1: \scViol{v}{d}{t})$ implies $\connViol{v}{t}$. It is however convenient to state the formation
violation condition in this manner, since, in the sequel, we formulate a ``local'' version for each of  
$(\exs d \ge 1: \scViol{v}{d}{t})$ and $\connViol{v}{t}$, and the implication does not necessarily hold for the local
versions. The advantage of the local versions is that they are usually efficiently computable, as we show in the sequel.
