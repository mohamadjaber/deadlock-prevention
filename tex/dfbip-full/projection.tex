

\bd[Structure Graph $\sg{\B}$, $\ssg{i}{\l}$, $\ssg{\act}{\l}$] \label{def:structure-graph} The structure
graph $\sg{\B}$ of composite component $B = \gamma(\B_1,\dots,\B_n)$ is a
bipartite graph whose nodes are the $\B_1, \ldots, \B_n$ and all the
$\act \in \gamma$.  There is an edge between $\B_i$ and
interaction $\act$ iff $\B_i$ participates in $\act$, \ie $\B_i \in \cmps{\act}$.  Define the
\emph{distance} between two nodes to be the number of edges in a shortest path
between them.  Let $\ssg{i}{\l}$ ($\ssg{\act}{\l}$ respectively) be the subgraph
of $\sg{\B}$ that contains $\B_i$ ($\act$ respectively) and all nodes of $\sg{\B}$
that have a distance to $\B_i$ ($\act$ respectively) less than or equal to $\l$.
%Let $\ssg{a}{k}$ be the union of $\ssg{i}{k}$ for all $\B_i \in \cmps{\act}$. 
\ed


\bd[Deadlock-checking subsystem, $\dsk{\act}{\l}$] \label{def:dsk}
Define $\dsk{\act}{\l}$, the \emph{deadlock-checking subsystem for interaction $\act$ and
depth $\l$}, to be the subsystem of $(\B, Q_0)$ based on $\ssg{\act}{\l}$.  % PREVIOUSLY: $\ssg{\act}{\l+2}$.
\ed

\bd[Border node, interior node of $\dsk{\act}{\l}$]  \label{def:dsk.border-and internal}
A node $v$ of $\dsk{\act}{\l}$ is a \emph{border-node} iff it has an
edge in $\sg{\B}$ to a node outside of $\dsk{\act}{\l}$.
If node $v$ of $\dsk{\act}{\l}$ is not a border node, then it is an \emph{internal node}.
\ed


\bp[Wait-for-edge projection] \label{prop:edge-projection}
%Let $(B, Q_0)$ be a BIP system, and 
Let $(\B', Q'_0)$ be a subsystem of
$(\B, Q_0)$. Let $s$ be a state of $(\B, Q_0)$, and $s' = s \pj \B'$.
Let $a$ be an interaction of $(\B', Q'_0)$, and $\B_i \in \cmps{\act}$ an atomic component of $\B'$.
Then 
(1) $\act \ar \B_i \in \wfg{\B}{s}$ iff $\act \ar \B_i \in \wfg{\B'}{s'}$, and
(2) $\B_i \ar \act \in \wfg{\B}{s}$ iff $\B_i \ar \act \in \wfg{\B'}{s'}$.
\ep
\prfs{
Since $s' = s \pj \B'$, all port enablement conditions of components in $\B'$ have the same value in $s$ and in
$s'$. The proposition then follows by straightforward application of Definition~\ref{def:static:wait-for-graph}.
}
\prf{
By Definition~\ref{def:static:wait-for-graph}, $\act \ar \B_i \in \wfg{\B}{s}$ iff $s \pj i (\gd{\act}{\B_i}) = \false$.
Since $s' = s \pj \B'$, we have $s' \pj i = s \pj i$. Hence
$s \pj i (\gd{\act}{\B_i}) = s' \pj i (\gd{\act}{\B_i})$.
By Definition~\ref{def:static:wait-for-graph}, 
$a \ar \B_i \in \wfg{\B'}{s'}$ iff $s' \pj i (\gd{\act}{\B_i}) = \false$.
Putting together these three equalities gives us clause (1).

By Definition~\ref{def:static:wait-for-graph},
$\B_i \ar \act \in \wfg{\B}{s}$ iff 
$s \pj i (\gd{\act}{\B_i}) = \true$.
Since $s' = s \pj \B'$, we have $s' \pj i = s \pj i$. Hence
$s \pj i (\gd{\act}{\B_i}) = s' \pj i (\gd{\act}{\B_i})$.
By Definition~\ref{def:static:wait-for-graph},
$\B_i \ar \act \in \wfg{\B'}{s'}$ iff $s' \pj i (\gd{\act}{\B_i}) = \true$.
Putting the above three equalities together gives us clause (2).
}
